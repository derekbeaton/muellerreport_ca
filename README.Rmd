---
title: "Correspondence analyses of the Mueller Report"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, echo=FALSE, warning=FALSE, message=FALSE}
library(ExPosition)
  # if needed.
# devtools::install_github("derekbeaton/GSVD")
# devtools::install_github("derekbeaton/OuRS", subdir = "/OuRS")
library(GSVD)
library(ours)

library(ggplot2)
library(gridExtra)
library(ggrepel)
```

# Background

[Come back to this. So I think this should break into three analyses. This one is the first/primary:
CAs of the frequencies per page. then the 0/1 and relate it to graphs, 
then MCD (which connects back to bivariate & row/column flip)]

# Explanation of the directory structure


# Cleaning and preprocessing

For processing of the text, I did little additional work on top of two analyses already performed: [batpigandme/tidymueller](https://github.com/batpigandme/tidymueller) and [cbail/mueller_report](https://github.com/cbail/mueller_report). A few extra cleaning steps were performed that align with [some of our previous work on NeuroSynth](https://www.biorxiv.org/content/10.1101/157826v3), and that code can be found in [fahd09/neurosynth_semantic_map](https://github.com/fahd09/neurosynth_semantic_map).

# Basics of the analyses

In principle, these analyses are virtually the same as what we did for the NeuroSynth database (see [our paper on correspondence analysis of manuscript-by-terms in the NeuroSynth database](https://www.biorxiv.org/content/10.1101/157826v3) and [fahd09/neurosynth_semantic_map](https://github.com/fahd09/neurosynth_semantic_map)).

# Correspondence analyses of the Mueller Report



```{r load_data_run_cas, echo=FALSE, warning=FALSE, message=FALSE}

page_by_word_counts.matrix_for_analyses <- read.csv(here::here("data","for_analyses","page_by_word_counts.matrix_for_analyses.csv"), row.names = 1)
page_by_word.matrix_for_analyses <- read.csv(here::here("data","for_analyses","page_by_word.matrix_for_analyses.csv"), row.names = 1)

page_by_lemma_counts.matrix_for_analyses <- read.csv(here::here("data","for_analyses","page_by_lemma_counts.matrix_for_analyses.csv"), row.names = 1)
page_by_lemma.matrix_for_analyses <- read.csv(here::here("data","for_analyses","page_by_lemma.matrix_for_analyses.csv"), row.names = 1)

words_counts_ca <- epCA(page_by_word_counts.matrix_for_analyses, graphs=F)
# words_ca <- epCA(page_by_word.matrix_for_analyses, graphs=F)
# words_gen.mcd <- cat.mcd(t(page_by_word.matrix_for_analyses), make.data.disjunctive = F, alpha = .75)

lemmas_counts_ca <- epCA(page_by_lemma_counts.matrix_for_analyses, graphs=F)
# lemmas_ca <- epCA(page_by_lemma.matrix_for_analyses, graphs=F)
# lemmas_gen.mcd <- cat.mcd(t(lemmas_ca), make.data.disjunctive = F, alpha = .75)



```


Scree plot stolen from [Matt Kmiecik](https://mattkmiecik.com/post-Exploring-11-Years-of-Chicago-Blackhawks-Data-using-Principal-Components-Analysis.html).

```{r summaries_diagnoistics, echo=FALSE, warning=FALSE, message=FALSE}

words_counts_ca_scree <- data.frame(eigs = words_counts_ca$ExPosition.Data$eigs,
                perc_explained = words_counts_ca$ExPosition.Data$t,
                comps = 1:length(words_counts_ca$ExPosition.Data$eigs)
                )

# words_ca_scree <- data.frame(eigs = words_ca$ExPosition.Data$eigs,
#                 perc_explained = words_ca$ExPosition.Data$t,
#                 comps = 1:length(words_ca$ExPosition.Data$eigs)
#                 )

lemmas_counts_ca_scree <- data.frame(eigs = lemmas_counts_ca$ExPosition.Data$eigs,
                perc_explained = lemmas_counts_ca$ExPosition.Data$t,
                comps = 1:length(lemmas_counts_ca$ExPosition.Data$eigs)
                )

# lemmas_ca_scree <- data.frame(eigs = lemmas_ca$ExPosition.Data$eigs,
#                 perc_explained = lemmas_ca$ExPosition.Data$t,
#                 comps = 1:length(lemmas_ca$ExPosition.Data$eigs)
#                 )


words_counts_ca_scree_plot <- ggplot(words_counts_ca_scree, aes(factor(comps), perc_explained)) +
  geom_point() +
  geom_path(aes(group = 1)) +
  labs(x = "Components", y = "Explained Variance (%)") +
  ggtitle("Scree Plot: Pages x Words (Counts)") +
  theme(axis.ticks.x = element_blank(), axis.text.x = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank())

# words_ca_scree_plot <- ggplot(words_ca_scree, aes(factor(comps), perc_explained)) +
#   geom_point() +
#   geom_path(aes(group = 1)) +
#   labs(x = "Components", y = "Explained Variance (%)") +
#   ggtitle("Scree Plot: Pages x Words (Binary)") +
#   theme(axis.ticks.x = element_blank(), axis.text.x = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank())
  
lemmas_counts_ca_scree_plot <- ggplot(lemmas_counts_ca_scree, aes(factor(comps), perc_explained)) +
  geom_point() +
  geom_path(aes(group = 1)) +
  labs(x = "Components", y = "Explained Variance (%)") +
  ggtitle("Scree Plot: Pages x Lemmas (Counts)") +
  theme(axis.ticks.x = element_blank(), axis.text.x = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank())

# lemmas_ca_scree_plot <- ggplot(lemmas_ca_scree, aes(factor(comps), perc_explained)) +
#   geom_point() +
#   geom_path(aes(group = 1)) +
#   labs(x = "Components", y = "Explained Variance (%)") +
#   ggtitle("Scree Plot: Pages x Lemmas (Binary)") +
#   theme(axis.ticks.x = element_blank(), axis.text.x = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank())

# grid.arrange(words_counts_ca_scree_plot, words_ca_scree_plot, lemmas_counts_ca_scree_plot, lemmas_ca_scree_plot, nrow = 2)
grid.arrange(words_counts_ca_scree_plot, lemmas_counts_ca_scree_plot, nrow = 1)
```



```{r visualize_components}

words_counts_ca_comps12_fi_df <- data.frame(
  COMP1 = words_counts_ca$ExPosition.Data$fi[,1],
  COMP2 = words_counts_ca$ExPosition.Data$fi[,2],
  PAGE_NUMBER = as.numeric(rownames(words_counts_ca$ExPosition.Data$fi))
)
words_counts_ca_comps12_fj_df <- data.frame(  
  COMP1 = words_counts_ca$ExPosition.Data$fj[,1],
  COMP2 = words_counts_ca$ExPosition.Data$fj[,2]
)
words_counts_xlims <- c(
  min(c(0.01,words_counts_ca_comps12_fi_df$COMP1,words_counts_ca_comps12_fi_df$COMP1)),
  max(c(-0.01,words_counts_ca_comps12_fi_df$COMP1,words_counts_ca_comps12_fi_df$COMP1))
)
words_counts_ylims <- c(
  min(c(0.01,words_counts_ca_comps12_fi_df$COMP1,words_counts_ca_comps12_fi_df$COMP2)),
  max(c(-0.01,words_counts_ca_comps12_fi_df$COMP1,words_counts_ca_comps12_fi_df$COMP2))
)

# words_ca_comps12_fi_df <- data.frame(
#   COMP1 = words_ca$ExPosition.Data$fi[,1],
#   COMP2 = words_ca$ExPosition.Data$fi[,2]
#   )
# words_ca_comps12_fj_df <- data.frame(  
#   COMP1 = words_ca$ExPosition.Data$fj[,1],
#   COMP2 = words_ca$ExPosition.Data$fj[,2]
# )
# words_lims <- max(max(abs(words_ca_comps12_fi_df)),max(abs(words_ca_comps12_fj_df)))

lemmas_counts_ca_comps12_fi_df <- data.frame(
  COMP1 = lemmas_counts_ca$ExPosition.Data$fi[,1],
  COMP2 = lemmas_counts_ca$ExPosition.Data$fi[,2]
)
lemmas_counts_ca_comps12_fj_df <- data.frame(
  COMP1 = lemmas_counts_ca$ExPosition.Data$fj[,1],
  COMP2 = lemmas_counts_ca$ExPosition.Data$fj[,2]
)
lemmas_counts_lims <- max(max(abs(lemmas_counts_ca_comps12_fi_df)),max(abs(lemmas_counts_ca_comps12_fj_df)))

# lemmas_ca_comps12_fi_df <- data.frame(
#   COMP1 = lemmas_ca$ExPosition.Data$fi[,1],
#   COMP2 = lemmas_ca$ExPosition.Data$fi[,2]
# )
# lemmas_ca_comps12_fj_df <- data.frame(
#   COMP1 = lemmas_ca$ExPosition.Data$fj[,1],
#   COMP2 = lemmas_ca$ExPosition.Data$fj[,2]
# )
# lemmas_lims <- max(max(abs(lemmas_ca_comps12_fi_df)),max(abs(lemmas_ca_comps12_fj_df)))


## I should color this by a gradient...
# words_counts.pages_component_map <- ggplot(words_counts_ca_comps12_fi_df, aes(COMP1, COMP2, label=rownames(words_counts_ca_comps12_fi_df))) +
#   geom_hline(yintercept = 0, color = "black") +
#   geom_vline(xintercept = 0, color="black") +
#   geom_point(color="black",fill="mediumorchid4", alpha=.7, shape=21) +
#   geom_text(aes(label=rownames(words_counts_ca_comps12_fi_df)),hjust=0, vjust=0, color="mediumorchid4",alpha=.7) +
#   # geom_text_repel(box.padding = .01, point.padding = .01) +
#   xlim(-words_counts_lims * 1.1, words_counts_lims * 1.1) +
#   ylim(-words_counts_lims * 1.1, words_counts_lims * 1.1) +
#   xlab(paste0("Component 1. Explained Variance: ", round(words_counts_ca$ExPosition.Data$t[1],digits=2), "%" ) ) +
#   ylab(paste0("Component 2. Explained Variance: ", round(words_counts_ca$ExPosition.Data$t[2],digits=2), "%" ) ) +
#   ggtitle("Pages x Words. Component Map of Pages.") +
#   theme(axis.line = element_blank(),
#     panel.border = element_blank(),
#     axis.text.x = element_blank(),
#     axis.text.y = element_blank(),
#     axis.ticks = element_blank(), 
#     panel.grid.major = element_blank(), 
#     panel.grid.minor = element_blank(), 
#     panel.background = element_blank())


words_counts.pages_component_map <- 
  ggplot(words_counts_ca_comps12_fi_df, aes(COMP1, COMP2, color=PAGE_NUMBER)) +
  geom_hline(yintercept = 0, color = "black") +
  geom_vline(xintercept = 0, color="black") +
  geom_point() +
  scale_color_gradient(low="blue", high="red") +
  # geom_text(aes(label=rownames(words_counts_ca_comps12_fi_df)),hjust=0, vjust=0, color="mediumorchid4",alpha=.7) +
  # geom_text_repel(box.padding = .01, point.padding = .01) +
  xlim(words_counts_xlims[1] * 1.1, words_counts_xlims[2] * 1.1) +
  ylim(words_counts_ylims[1] * 1.1, words_counts_ylims[2] * 1.1) +
  xlab(paste0("Component 1. Explained Variance: ", round(words_counts_ca$ExPosition.Data$t[1],digits=2), "%" ) ) +
  ylab(paste0("Component 2. Explained Variance: ", round(words_counts_ca$ExPosition.Data$t[2],digits=2), "%" ) ) +
  ggtitle("Pages x Words. Component Map of Pages.") +
  theme(axis.line = element_blank(),
    panel.border = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank(), 
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank(), 
    panel.background = element_blank())


words_counts.words_component_map <- ggplot(words_counts_ca_comps12_fj_df, aes(COMP1, COMP2, label=rownames(words_counts_ca_comps12_fj_df))) +
  geom_hline(yintercept = 0, color = "black") +
  geom_vline(xintercept = 0, color="black") +
  geom_point(color="black",fill="olivedrab3", alpha=.7, shape=21) +
  # geom_text_repel(box.padding = .01, point.padding = .01) +
  xlim(-words_counts_lims * 1.1, words_counts_lims * 1.1) +
  ylim(-words_counts_lims * 1.1, words_counts_lims * 1.1) +
  xlab(paste0("Component 1. Explained Variance: ", round(words_counts_ca$ExPosition.Data$t[1],digits=2), "%" ) ) +
  ylab(paste0("Component 2. Explained Variance: ", round(words_counts_ca$ExPosition.Data$t[2],digits=2), "%" ) ) +
  ggtitle("Pages x Words. Component Map of Words.") +
  theme(axis.line = element_blank(),
    panel.border = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank(), 
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank(), 
    panel.background = element_blank())


lemmas_counts.pages_component_map <- ggplot(lemmas_counts_ca_comps12_fi_df, aes(COMP1, COMP2, label=rownames(lemmas_counts_ca_comps12_fi_df))) +
  geom_hline(yintercept = 0, color = "black") +
  geom_vline(xintercept = 0, color="black") +
  geom_point(color="mediumorchid4") +
  # geom_text_repel(box.padding = .01, point.padding = .01) +
  xlim(-lemmas_counts_lims * 1.1, lemmas_counts_lims * 1.1) +
  ylim(-lemmas_counts_lims * 1.1, lemmas_counts_lims * 1.1) +
  xlab(paste0("Component 1. Explained Variance: ", round(lemmas_counts_ca$ExPosition.Data$t[1],digits=2), "%" ) ) +
  ylab(paste0("Component 2. Explained Variance: ", round(lemmas_counts_ca$ExPosition.Data$t[2],digits=2), "%" ) ) +
  ggtitle("Pages x Lemmas. Component Map of Pages") +
  theme(axis.line = element_blank(),
    panel.border = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank(), 
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank(), 
    panel.background = element_blank())


lemmas_counts.lemmas_component_map <- ggplot(lemmas_counts_ca_comps12_fj_df, aes(COMP1, COMP2, label=rownames(lemmas_counts_ca_comps12_fj_df))) +
  geom_hline(yintercept = 0, color = "black") +
  geom_vline(xintercept = 0, color="black") +
  geom_point(color="olivedrab3") +
  # geom_text_repel(box.padding = .01, point.padding = .01) +
  xlim(-lemmas_counts_lims * 1.1, lemmas_counts_lims * 1.1) +
  ylim(-lemmas_counts_lims * 1.1, lemmas_counts_lims * 1.1) +
  xlab(paste0("Component 1. Explained Variance: ", round(lemmas_counts_ca$ExPosition.Data$t[1],digits=2), "%" ) ) +
  ylab(paste0("Component 2. Explained Variance: ", round(lemmas_counts_ca$ExPosition.Data$t[2],digits=2), "%" ) ) +
  ggtitle("Pages x Lemmas Component Map of Lemmas.") +
  theme(axis.line = element_blank(),
    panel.border = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank(), 
    panel.grid.major = element_blank(), 
    panel.grid.minor = element_blank(), 
    panel.background = element_blank())


grid.arrange(words_counts.pages_component_map, words_counts.words_component_map,
             lemmas_counts.pages_component_map, lemmas_counts.lemmas_component_map,
             nrow=2)
```


```{r comparisons}

## corrplots or similar heatmaps?


```

